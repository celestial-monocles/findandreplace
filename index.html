<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Caprasimo&display=swap" rel="stylesheet">
  <title>Find and Replace</title>
  <style>
    * {
      box-sizing: border-box;
    }

    body {
      font-family: Georgia, serif;
      margin: 20px;
      padding: 20px;
      background-color: #2a2a2a;
      color: #B5AEE8;
    }

    a {
      color: #B5AEE8;
      text-decoration: none;
    }

    #container {
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
      text-align: center;
    }

    .find-replace-pair {
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .find-replace-pair label {
      margin-right: 10px;
    }

    .find-replace-pair input {
      margin-right: 10px;
    }

    .remove-button {
      margin-left: 10px;
      color: red;
      cursor: pointer;
      font-weight: bold;
      margin-top: 2px;
    }

    .drag-handle {
      cursor: move;
      margin-right: 10px;
      font-size: 18px;
    }

    .dragging {
      opacity: 0.5;
    }

    #inputAreaContainer {
      margin-bottom: 20px;
    }

    .toggles {
      margin-bottom: 20px;
    }

    .toggles label {
      margin-right: 15px;
    }

    textarea {
      width: 100%;
    }

    #resultText {
      background-color: #C7BAE3;
    }

    button {
      background-color: #B287CC;
      color: white;
      border: none;
      padding: 10px 20px;
      margin: 5px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: bold;
      font-family: inherit;
      transition: background-color 0.2s ease;
    }

    button:hover {
      background-color: #A84B8C;
    }

    #scrollBtn {
      position: fixed;
      bottom: 20px;
      right: 20px;
      z-index: 99;
      background-color: #B287CC;
      color: white;
      width: 48px;
      height: 48px;
      font-size: 24px;
      font-weight: bold;
      border-radius: 50%;
      box-shadow: 0 2px 6px rgba(0,0,0,0.3);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    #replacementSection {
      margin-top: 20px;
      text-align: left;
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
    }

    #replacementDetails {
      display: none;
      margin-top: 10px;
    }

    #inputBtn {
      background-color: #A84A46;
      color: white;
    }

    #inputBtn:hover {
      background-color: #A90101;
    }

    #clearBtn {
      background-color: #A84A46;
      color: white;
    }

    #clearBtn:hover {
      background-color: #A90101;
    }

    #toggleReplacementsBtn {
      background-color: #2a2a2a;
    }

    @media (max-width: 768px) {
      .find-replace-pair {
        flex-direction: column;
        align-items: stretch;
        text-align: left;
      }

      .find-replace-pair label,
      .find-replace-pair input,
      .remove-button,
      .drag-handle {
        width: 100%;
        margin: 5px 0;
      }

      button {
        width: 100%;
        margin: 5px 0;
      }

      #copyButton {
        width: 100%;
      }

      .toggles {
        display: flex;
        flex-direction: column;
        align-items: flex-start;
      }

      .toggles label {
        margin-bottom: 10px;
      }
    }
  </style>
</head>
<body>
  <div id="container">
    <h1><a href="https://celestial-monocles.github.io/findnreplace/">Find and Replace Text</a></h1>

    <div id="inputAreaContainer">
      <textarea id="inputText" rows="10" placeholder="Enter your text here..."></textarea><br>
      <button id="inputBtn" onclick="clearInputText()">Clear Input</button>
    </div>

    <h2>Find and Replace List</h2>
    <div id="findReplaceContainer">
      <div class="find-replace-pair">
        <span class="drag-handle">☰</span>
        <label>Find: </label>
        <input type="text" class="find" placeholder="Find">
        <label>Replace with: </label>
        <input type="text" class="replace" placeholder="Replace">
        <span class="remove-button" onclick="removePair(this)">✖</span>
      </div>
    </div>
    <button onclick="addFindReplacePair()">Add</button>
    <button id="clearBtn" onclick="clearFindReplaceInputs()">Clear</button><br><br>

    <div class="toggles">
      <label><input type="checkbox" id="matchCase"> Match Case</label>
      <label><input type="checkbox" id="wholeWords"> Whole Words</label>
    </div>

    <button onclick="replaceText()">Replace</button><br><br>

    <h2>Result:</h2>
    <textarea id="resultText" rows="10" readonly></textarea><br><br>
    <button id="copyButton" onclick="copyResultText()" style="display:none;">Copy Result</button>

    <div id="replacementSection">
      <button id="toggleReplacementsBtn" onclick="toggleReplacements()" style="display:none;">▼ Replacements</button>
      <div id="replacementDetails"></div>
    </div>
  </div>

  <button id="scrollBtn" onclick="toggleScroll()" title="Scroll">↓</button>

  <!-- SortableJS -->
  <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>

  <script>
    function escapeRegExp(string) {
      return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
    }

    function addFindReplacePair() {
      const container = document.getElementById('findReplaceContainer');
      const newPair = document.createElement('div');
      newPair.classList.add('find-replace-pair');
      newPair.innerHTML = `
        <span class="drag-handle">☰</span>
        <label>Find: </label>
        <input type="text" class="find" placeholder="Find">
        <label>Replace with: </label>
        <input type="text" class="replace" placeholder="Replace">
        <span class="remove-button" onclick="removePair(this)">✖</span>
      `;
      container.appendChild(newPair);
    }

    function removePair(button) {
      const container = document.getElementById('findReplaceContainer');
      const pairs = container.getElementsByClassName('find-replace-pair');
      if (pairs.length > 1) {
        button.parentElement.remove();
      } else {
        alert("At least one Find/Replace pair must remain.");
      }
    }

    function clearInputText() {
      document.getElementById("inputText").value = '';
      toggleCopyButtonVisibility();
    }

    function clearFindReplaceInputs() {
      const findInputs = document.querySelectorAll('.find');
      const replaceInputs = document.querySelectorAll('.replace');
      findInputs.forEach(input => input.value = '');
      replaceInputs.forEach(input => input.value = '');
    }

    function replaceText() {
      let text = document.getElementById("inputText").value;
      const finds = document.querySelectorAll('.find');
      const replaces = document.querySelectorAll('.replace');
      const matchCase = document.getElementById("matchCase").checked;
      const wholeWords = document.getElementById("wholeWords").checked;
      let flags = matchCase ? 'g' : 'gi';

      const counts = [];

      for (let i = 0; i < finds.length; i++) {
        const find = finds[i].value;
        const replace = replaces[i].value;
        if (find) {
          let pattern = wholeWords ? `\\b${escapeRegExp(find)}\\b` : escapeRegExp(find);
          let regex = new RegExp(pattern, flags);

          // Count matches
          let matchCount = 0;
          const clone = new RegExp(pattern, flags);
          while (clone.exec(text)) {
            matchCount++;
          }

          text = text.replace(regex, replace);
          counts.push(`${find} → ${replace}: ${matchCount} replacement${matchCount !== 1 ? 's' : ''}`);
        }
      }

      document.getElementById("resultText").value = text;
      toggleCopyButtonVisibility();

      const replacementDetails = document.getElementById("replacementDetails");
      const toggleBtn = document.getElementById("toggleReplacementsBtn");

      if (counts.length > 0) {
        replacementDetails.innerHTML = `➤ ` + counts.join('<br>➤ ');
        toggleBtn.style.display = 'inline-block';
        replacementDetails.style.display = 'none';
        toggleBtn.textContent = "▼ Replacements";
      } else {
        replacementDetails.innerHTML = '';
        toggleBtn.style.display = 'none';
      }
    }

    function toggleReplacements() {
      const details = document.getElementById("replacementDetails");
      const toggleBtn = document.getElementById("toggleReplacementsBtn");

      if (details.style.display === "none") {
        details.style.display = "block";
        toggleBtn.textContent = "▲ Replacements";
      } else {
        details.style.display = "none";
        toggleBtn.textContent = "▼ Replacements";
      }
    }

    function toggleCopyButtonVisibility() {
      const resultText = document.getElementById("resultText");
      const copyButton = document.getElementById("copyButton");
      copyButton.style.display = resultText.value.trim() === '' ? 'none' : 'inline-block';
    }

    function copyResultText() {
      const resultText = document.getElementById("resultText");
      resultText.select();
      resultText.setSelectionRange(0, 99999);

      navigator.clipboard.writeText(resultText.value)
        .then(() => {
          const copyButton = document.getElementById("copyButton");
          copyButton.textContent = "Copied!";
          setTimeout(() => copyButton.textContent = "Copy Result", 2000);
        })
        .catch(err => console.error('Failed to copy text:', err));
    }

    let atBottom = false;

    function toggleScroll() {
      if (atBottom) {
        window.scrollTo({ top: 0, behavior: 'smooth' });
      } else {
        window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
      }
      atBottom = !atBottom;
      document.getElementById("scrollBtn").textContent = atBottom ? "↑" : "↓";
    }

    // Enable sortable reordering
    new Sortable(document.getElementById('findReplaceContainer'), {
      animation: 150,
      handle: '.drag-handle',
      ghostClass: 'dragging'
    });
  </script>
</body>
</html>
